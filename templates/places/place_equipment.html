{% extends "base.html" %}
{% block title %}ТМЦ в помещении: {{ place.name }}{% endblock %}
{% block content %}
<div class="page-header">
    <div>
        <h1>ТМЦ в помещении: "{{ place.name }}"</h1>
        <p class="text-muted mb-0">
            Всего: {{ tmc_count }} шт. | 
            Общая стоимость: {{ "{:,.2f}".format(total_cost).replace(',', ' ').replace('.', ',') }} ₽
        </p>
    </div>
    <div class="user-info">
        <a href="{{ url_for('my_places') }}" class="btn btn-secondary btn-sm">
            <i class="bi bi-arrow-left me-1"></i>Назад к помещениям
        </a>
    </div>
</div>

{% if equipment_list %}
<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th scope="col" style="width: 80px;">Фото</th>
                        <th scope="col">Наименование</th>
                        <th scope="col">Серийный номер</th>
                        <th scope="col">Инвентарный номер</th>
                        <th scope="col">Комментарий</th>
                        <th scope="col">Дата постановки</th>
                        <th scope="col">Стоимость</th>
                        <th scope="col">Статус</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tmc in equipment_list %}
                    <tr class="clickable-row" onclick="window.location='{{ url_for('info_tmc', tmc_id=tmc.id) }}'" style="cursor: pointer;">
                        <td>
                            {% if tmc.photo and tmc.photo.strip() %}
                                <img src="{{ url_for('static', filename='uploads/' + tmc.photo) }}" 
                                     alt="Фото" 
                                     class="img-fluid rounded" 
                                     style="max-height: 60px; max-width: 60px; object-fit: cover;">
                            {% elif tmc.nome and tmc.nome.photo and tmc.nome.photo.strip() %}
                                <img src="{{ url_for('static', filename='uploads/' + tmc.nome.photo) }}" 
                                     alt="Фото группы" 
                                     class="img-fluid rounded" 
                                     style="max-height: 60px; max-width: 60px; object-fit: cover;">
                            {% else %}
                                <img src="{{ url_for('static', filename='uploads/noimage.jpg') }}" 
                                     alt="Нет фото" 
                                     class="img-fluid rounded" 
                                     style="max-height: 60px; max-width: 60px; object-fit: cover;">
                            {% endif %}
                        </td>
                        <td>
                            {% if tmc.buhname and tmc.buhname.strip() %}
                                <span title="{{ tmc.buhname|replace('"', '&quot;') }}" style="display: block; max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                    {{ tmc.buhname }}
                                </span>
                            {% else %}
                                <span class="text-muted">—</span>
                            {% endif %}
                        </td>
                        <td>{{ tmc.sernum or '—' }}</td>
                        <td>{{ tmc.invnum or '—' }}</td>
                        <td>
                            {% if tmc.comment and tmc.comment.strip() %}
                                <span title="{{ tmc.comment|replace('"', '&quot;') }}" style="display: block; max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                    {{ tmc.comment }}
                                </span>
                            {% else %}
                                <span class="text-muted" style="font-style: italic;">Нет комментария</span>
                            {% endif %}
                        </td>
                        <td>{{ tmc.datepost.strftime('%d.%m.%Y') if tmc.datepost else '—' }}</td>
                        <td>{{ "{:,.2f}".format(tmc.cost) if tmc.cost else '0.00' }} руб.</td>
                        <td onclick="event.stopPropagation();">
                            {% if tmc.active %}
                                {% if tmc.lost %}
                                    <span class="badge bg-danger">Потерян</span>
                                {% elif tmc.repair %}
                                    <span class="badge bg-warning text-dark">В ремонте</span>
                                {% elif tmc.mode %}
                                    <span class="badge bg-info">На модернизации</span>
                                {% elif tmc.disposed %}
                                    <span class="badge bg-secondary">Списано</span>
                                {% else %}
                                    <span class="badge bg-success">В эксплуатации</span>
                                {% endif %}
                            {% else %}
                                <span class="badge bg-secondary">Неактивно</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% else %}
<div class="card">
    <div class="card-body">
        <div class="empty-state">
            <i class="bi bi-clipboard-data" style="font-size: 3rem;"></i>
            <h5>Нет данных</h5>
            <p class="mb-0">В этом помещении нет ТМЦ.</p>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
