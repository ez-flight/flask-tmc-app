# üñ•Ô∏è –°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ –¢–ú–¶ (–¢–æ–≤–∞—Ä–Ω–æ-–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã—Ö –¶–µ–Ω–Ω–æ—Å—Ç–µ–π)

**Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É—á–µ—Ç–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è –¢–ú–¶ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ñ–æ—Ç–æ, –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –æ—Ç–¥–µ–ª–∞–º, –≥—Ä—É–ø–ø–∞–º –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è–º.**

> üìå **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Flask –ø—Ä–æ–µ–∫—Ç –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º [webuseorg3](https://github.com/donpadlo/webuseorg3), –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ —Å–≤–æ–π –ª–∞–¥.

---

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#-–æ—Å–Ω–æ–≤–Ω—ã–µ-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#Ô∏è-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [API Endpoints](#-api-endpoints)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
- [–°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –∏ –¥–æ—Å—Ç—É–ø–æ–≤](#-—Å–∏—Å—Ç–µ–º–∞-—Ä–æ–ª–µ–π-–∏-–¥–æ—Å—Ç—É–ø–æ–≤)
- [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
- [Troubleshooting](#-troubleshooting)
- [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

---

## üìå –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üîß –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ **CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏** –¥–ª—è –¢–ú–¶ (—Å–æ–∑–¥–∞–Ω–∏–µ, —á—Ç–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ)
- üì∏ **–ó–∞–≥—Ä—É–∑–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏** (—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `/var/www/html/photos`, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Nginx)
- üîç **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** –ø–æ –æ—Ç–¥–µ–ª–∞–º, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- üìÑ **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** (–ø–∞—Å–ø–æ—Ä—Ç–∞, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏)

### üè¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- üßë‚Äçüíº **–ü—Ä–∏–≤—è–∑–∫–∞ –∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**, –º–µ—Å—Ç—É –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–ú–û–õ)
- üè¢ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª–∞–º–∏** (–û—Ç–¥–µ–ª —Å–≤—è–∑–∏, –û–¢–û, –ü–° –∏ –¥—Ä.)
- üë• **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏ (–ê–¥–º–∏–Ω, –ú–û–õ, –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- üìç **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Å—Ç–∞–º–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è** (—Å–∫–ª–∞–¥—ã, –æ—Ñ–∏—Å—ã)

### üß© –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¢–ú–¶
- üß© **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:** –ö–∞—Ç–µ–≥–æ—Ä–∏—è ‚Üí –ì—Ä—É–ø–ø–∞ ‚Üí –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å ‚Üí –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
- ‚ûï **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ** –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–π –ø—Ä—è–º–æ –∏–∑ —Ñ–æ—Ä–º—ã
- üîó **–°–æ—Å—Ç–∞–≤–Ω—ã–µ –¢–ú–¶** —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏—Ö
- üì¶ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–º–∏** –¥–ª—è —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –¢–ú–¶ (–æ–¥–∏–Ω —Ç–∏–ø –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–µ–≥–æ –Ω–∞ –¢–ú–¶)

### üìä –£—á–µ—Ç –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å
- üìà **–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¢–ú–¶
- üîÑ **–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π** –º–µ–∂–¥—É –ú–û–õ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- üìù **–ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤** –∫ –¢–ú–¶ (–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤)
- üìã **–í—Ä–µ–º–µ–Ω–Ω–∞—è –≤—ã–¥–∞—á–∞ –¢–ú–¶** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º
- üìë **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–º–∏** –∏ –ø—Ä–∏–≤—è–∑–∫–∞ –¢–ú–¶ –∫ –Ω–∞–∫–ª–∞–¥–Ω—ã–º

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –¥–æ—Å—Ç—É–ø
- üîí **–°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π** (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, –ú–û–õ, –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- üë§ **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏** —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- üîê **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** —á–µ—Ä–µ–∑ Flask-Login
- üõ°Ô∏è **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π** SHA1(salt + password) –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Frontend (Jinja2)               ‚îÇ
‚îÇ  - Bootstrap 5                          ‚îÇ
‚îÇ  - JavaScript (Vanilla)                 ‚îÇ
‚îÇ  - Responsive Design                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Flask Application (app.py)         ‚îÇ
‚îÇ  - Flask 3.1.2                         ‚îÇ
‚îÇ  - Flask-SQLAlchemy 3.1.1              ‚îÇ
‚îÇ  - Flask-Login 0.6.3                    ‚îÇ
‚îÇ  - Werkzeug 3.1.3                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Database Layer (SQLAlchemy)        ‚îÇ
‚îÇ  - SQLAlchemy 2.0.43                    ‚îÇ
‚îÇ  - PyMySQL 1.1.2                       ‚îÇ
‚îÇ  - MySQL 8.0+                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
app.py                    # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ä–æ—É—Ç—ã, –ª–æ–≥–∏–∫–∞)
models.py                 # –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (SQLAlchemy ORM)
‚îú‚îÄ‚îÄ Context Processors    # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤
‚îú‚îÄ‚îÄ Authentication        # Flask-Login –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Routes                # 43+ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
‚îî‚îÄ‚îÄ Business Logic        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö, –≤–∞–ª–∏–¥–∞—Ü–∏—è
```

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- **MVC (Model-View-Controller)**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏, –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
- **Repository Pattern**: –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º —á–µ—Ä–µ–∑ SQLAlchemy
- **Decorator Pattern**: `@login_required`, `@app.route`

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```
flask_tmc_app/
‚îú‚îÄ‚îÄ app.py                 # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Flask
‚îú‚îÄ‚îÄ models.py              # –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ requirements.txt       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îÇ
‚îú‚îÄ‚îÄ migrations/            # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ migrate_*.py       # –°–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ *.sql             # SQL —Å–∫—Ä–∏–ø—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ scripts/               # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ download_static_assets.py
‚îÇ   ‚îú‚îÄ‚îÄ extract_static_files.py
‚îÇ   ‚îî‚îÄ‚îÄ test_mode.py
‚îÇ
‚îú‚îÄ‚îÄ docs/                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ COMPATIBILITY.md
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ templates/             # HTML —à–∞–±–ª–æ–Ω—ã
‚îú‚îÄ‚îÄ static/                # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (CSS, JS, fonts, uploads)
‚îî‚îÄ‚îÄ nginx/                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
```

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:** –°–º. [`PROJECT_STRUCTURE.md`](PROJECT_STRUCTURE.md)

---

## üöÄ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|--------|------------|
| **Python** | 3.8+ | –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ |
| **MySQL** | 8.0+ | –†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| **Nginx** | 1.18+ | –í–µ–±-—Å–µ—Ä–≤–µ—Ä –∏ reverse proxy |
| **Gunicorn** | - | WSGI —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ |
| **–û–°** | Linux (Ubuntu 20.04+) | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ |

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python

–í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∫–∞–∑–∞–Ω—ã –≤ `requirements.txt`:
- Flask 3.1.2
- Flask-SQLAlchemy 3.1.1
- Flask-Login 0.6.3
- SQLAlchemy 2.0.43
- PyMySQL 1.1.2
- python-dateutil 2.9.0
- python-dotenv 1.1.1
- cryptography 46.0.1

---

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```bash
git clone https://github.com/–≤–∞—à-–ª–æ–≥–∏–Ω/flask-tmc-app.git
cd flask-tmc-app
```

> üí° **–°–æ–≤–µ—Ç:** –ï—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ:
> ```bash
> git init
> git remote add origin https://github.com/–≤–∞—à-–ª–æ–≥–∏–Ω/flask-tmc-app.git
> ```

---

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python3 -m venv venv

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate    # Windows

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
```

---

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö MySQL

#### –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
CREATE DATABASE webuseorg3 CHARACTER SET utf8mb3 COLLATE utf8mb3_bin;

USE webuseorg3;

-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
CREATE USER 'tmc_user'@'localhost' IDENTIFIED BY 'strong_password';
GRANT ALL PRIVILEGES ON webuseorg3.* TO 'tmc_user'@'localhost';
FLUSH PRIVILEGES;
```

#### –ò–º–ø–æ—Ä—Ç —Å—Ö–µ–º—ã

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–∞–º–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
```bash
mysql -u root -p webuseorg3 < database_dump.sql
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –æ—Ç–¥–µ–ª–æ–≤
CREATE TABLE IF NOT EXISTS `department` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(255) NOT NULL,
  `code` VARCHAR(50) NOT NULL COMMENT '–ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –û–°, –û–¢–û)',
  `active` TINYINT(1) NOT NULL DEFAULT 1,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_bin;

-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞ department_id –≤ equipment (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
ALTER TABLE `equipment`
ADD COLUMN IF NOT EXISTS `department_id` INT NULL DEFAULT NULL AFTER `tmcgo`,
ADD INDEX IF NOT EXISTS `fk_equipment_department_idx` (`department_id` ASC);

ALTER TABLE `equipment`
ADD CONSTRAINT IF NOT EXISTS `fk_equipment_department`
  FOREIGN KEY (`department_id`)
  REFERENCES `department` (`id`)
  ON DELETE SET NULL
  ON UPDATE CASCADE;

-- –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç–¥–µ–ª–æ–≤
INSERT INTO `department` (`name`, `code`, `active`) VALUES
('–û—Ç–¥–µ–ª —Å–≤—è–∑–∏', '–û–°', 1),
('–û—Ç–¥–µ–ª —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è', '–û–¢–û', 1),
('–ü—Ä–æ—Ç–∏–≤–æ–ø–æ–∂–∞—Ä–Ω–∞—è —Å–ª—É–∂–±–∞', '–ü–°', 1)
ON DUPLICATE KEY UPDATE name=name;
```

---

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è Flask (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ!)
SECRET_KEY=your_secret_key_here_min_32_chars

# URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=mysql+pymysql://tmc_user:strong_password@localhost/webuseorg3

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
UPLOAD_FOLDER=/var/www/html/photos
MAX_UPLOAD_SIZE=16777216  # 16MB –≤ –±–∞–π—Ç–∞—Ö
ALLOWED_EXTENSIONS=jpg,jpeg,png,gif,pdf,doc,docx
```

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞:**
```bash
python3 -c "import secrets; print(secrets.token_hex(32))"
```

> ‚ö†Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** 
> - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
> - –î–æ–±–∞–≤—å—Ç–µ `.env` –≤ `.gitignore`
> - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è MySQL

---

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞–ø–∫–∏ –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
sudo mkdir -p /var/www/html/photos

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
sudo chown -R $USER:$USER /var/www/html/photos
sudo chmod -R 755 /var/www/html/photos

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
ln -s /var/www/html/photos static/uploads
```

---

### 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/etc/nginx/sites-available/flask-tmc`:

```nginx
server {
    listen 80;
    server_name –≤–∞—à_IP_–∏–ª–∏_–¥–æ–º–µ–Ω;  # –ù–∞–ø—Ä–∏–º–µ—Ä, 192.168.100.106 –∏–ª–∏ tmc.example.com

    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    access_log /var/log/nginx/flask-tmc-access.log;
    error_log /var/log/nginx/flask-tmc-error.log;

    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞
    client_max_body_size 20M;

    # –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # –†–∞–∑–¥–∞—á–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
    location /photos/ {
        alias /var/www/html/photos/;
        expires 1y;
        add_header Cache-Control "public, immutable";
        
        # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
        add_header X-Content-Type-Options "nosniff";
    }

    # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
    location /static/ {
        alias /home/flask_tmc_app/static/;
        expires 30d;
        add_header Cache-Control "public";
    }
}
```

#### –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏
sudo ln -s /etc/nginx/sites-available/flask-tmc /etc/nginx/sites-enabled/

# –£–¥–∞–ª–µ–Ω–∏–µ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
sudo rm /etc/nginx/sites-enabled/default

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Nginx
sudo systemctl restart nginx
```

---

### 7. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
cd /home/flask_tmc_app
source venv/bin/activate
export FLASK_ENV=development
export FLASK_DEBUG=1
python3 app.py
```

> ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:5000` –∏–ª–∏ —á–µ—Ä–µ–∑ Nginx

#### –†–µ–∂–∏–º –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

–°–º. —Ä–∞–∑–¥–µ–ª [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|----------|--------|
| `SECRET_KEY` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è Flask —Å–µ—Å—Å–∏–π | `secrets.token_hex(32)` |
| `DATABASE_URL` | URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MySQL | `mysql+pymysql://user:pass@localhost/db` |
| `UPLOAD_FOLDER` | –ü—É—Ç—å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ | `/var/www/html/photos` |
| `MAX_UPLOAD_SIZE` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–±–∞–π—Ç—ã) | `16777216` (16MB) |

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Flask (app.py)

```python
app.config['SECRET_KEY'] = os.getenv('SECRET_KEY')
app.config['SQLALCHEMY_DATABASE_URI'] = os.getenv('DATABASE_URL')
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False  # –û—Ç–∫–ª—é—á–µ–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π**: SHA1(salt + password) –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- **–°–µ—Å—Å–∏–∏**: Flask-Login —Å cookie-based –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- **CSRF**: –ó–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ Flask-WTF (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å)
- **File Upload**: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –∏ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤

---

## üîå API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø |
|-------|------|----------|--------|
| `GET/POST` | `/login` | –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É | –ü—É–±–ª–∏—á–Ω—ã–π |
| `GET` | `/logout` | –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π |

### –¢–ú–¶ (–û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø |
|-------|------|----------|--------|
| `GET` | `/` | –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π |
| `GET/POST` | `/add` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¢–ú–¶ | –ú–û–õ/–ê–¥–º–∏–Ω |
| `GET/POST` | `/edit/<int:tmc_id>` | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¢–ú–¶ | –ú–û–õ/–ê–¥–º–∏–Ω |
| `POST` | `/delete/<int:tmc_id>` | –£–¥–∞–ª–µ–Ω–∏–µ –¢–ú–¶ | –ê–¥–º–∏–Ω |
| `GET` | `/info_tmc/<int:tmc_id>` | –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¢–ú–¶ | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π |
| `GET` | `/list_by_nome/<int:nome_id>` | –°–ø–∏—Å–æ–∫ –¢–ú–¶ –ø–æ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—é | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π |

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø |
|-------|------|----------|--------|
| `GET` | `/all_tmc` | –í—Å–µ –¢–ú–¶ (—Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏) | –ê–¥–º–∏–Ω |
| `GET` | `/my_tmc` | –ú–æ–∏ –¢–ú–¶ | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π |
| `GET` | `/get_vendors_by_group/<int:group_id>` | –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π –ø–æ –≥—Ä—É–ø–ø–µ | AJAX |
| `GET` | `/get_nomenclatures_by_group_and_vendor/<int:group_id>/<int:vendor_id>` | –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—É | AJAX |

### –ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø |
|-------|------|----------|--------|
| `GET/POST` | `/add_nome` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è | –ê–¥–º–∏–Ω |
| `GET/POST` | `/edit_nome/<int:nome_id>` | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è | –ê–¥–º–∏–Ω |
| `GET/POST` | `/bulk_edit_nome/<int:nome_id>` | –ì—Ä—É–ø–ø–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | –ê–¥–º–∏–Ω |
| `GET/POST` | `/edit_nome_group/<int:nome_id>` | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –¢–ú–¶ | –ê–¥–º–∏–Ω/–ú–û–õ |
| `POST` | `/add_nomenclature` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã –∏–∑ —Ñ–æ—Ä–º—ã | AJAX |

### –ö–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø |
|-------|------|----------|--------|
| `GET` | `/all_components` | –í—Å–µ –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π |
| `GET/POST` | `/add_component` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–µ–≥–æ | –ú–û–õ/–ê–¥–º–∏–Ω |
| `GET/POST` | `/edit_component/<int:component_id>` | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–µ–≥–æ | –ú–û–õ/–ê–¥–º–∏–Ω |

### –í—Ä–µ–º–µ–Ω–Ω–∞—è –≤—ã–¥–∞—á–∞

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø |
|-------|------|----------|--------|
| `POST` | `/temp_assign` | –í—ã–¥–∞—á–∞ –¢–ú–¶ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | –ú–û–õ/–ê–¥–º–∏–Ω |
| `POST` | `/temp_return/<int:usage_id>` | –í–æ–∑–≤—Ä–∞—Ç –¢–ú–¶ | –ú–û–õ/–ê–¥–º–∏–Ω |
| `GET` | `/my_temp_tmc` | –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¢–ú–¶ | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π |
| `GET` | `/my_friends` | –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π (–ú–û–õ/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏) | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π |
| `GET` | `/friend_equipment/<int:friend_user_id>` | –¢–ú–¶ –¥—Ä—É–≥–∞ | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π |

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø |
|-------|------|----------|--------|
| `GET` | `/all_stats` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–≤—Å–µ –¢–ú–¶) | –ê–¥–º–∏–Ω |
| `GET` | `/my_stats` | –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | –ú–û–õ |
| `GET` | `/all_moves` | –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π (–≤—Å–µ) | –ê–¥–º–∏–Ω |
| `GET` | `/my_moves` | –ú–æ–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è | –ú–û–õ |

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø |
|-------|------|----------|--------|
| `GET` | `/manage_users` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ | –ê–¥–º–∏–Ω |
| `GET/POST` | `/edit_user/<int:user_id>` | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | –ê–¥–º–∏–Ω |
| `GET/POST` | `/edit_my_profile` | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π |

### –ù–∞–∫–ª–∞–¥–Ω—ã–µ

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø |
|-------|------|----------|--------|
| `GET` | `/invoice_list` | –°–ø–∏—Å–æ–∫ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö | –ú–û–õ/–ê–¥–º–∏–Ω |
| `GET/POST` | `/create_invoice` | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–∫–ª–∞–¥–Ω–æ–π | –ú–û–õ/–ê–¥–º–∏–Ω |
| `GET` | `/invoice/<int:invoice_id>` | –ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞–∫–ª–∞–¥–Ω–æ–π | –ú–û–õ/–ê–¥–º–∏–Ω |
| `GET/POST` | `/edit_invoice/<int:invoice_id>` | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∫–ª–∞–¥–Ω–æ–π | –ú–û–õ/–ê–¥–º–∏–Ω |
| `POST` | `/delete_invoice/<int:invoice_id>` | –£–¥–∞–ª–µ–Ω–∏–µ –Ω–∞–∫–ª–∞–¥–Ω–æ–π | –ê–¥–º–∏–Ω |
| `GET` | `/api/equipment_by_user/<int:user_id>` | API: –¢–ú–¶ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é | AJAX |

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –Ω–æ–≤–æ—Å—Ç–∏

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø |
|-------|------|----------|--------|
| `GET/POST` | `/manage_categories` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ | –ê–¥–º–∏–Ω |
| `GET/POST` | `/manage_news` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç—è–º–∏ | –ê–¥–º–∏–Ω |
| `GET/POST` | `/add_news` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ | –ê–¥–º–∏–Ω |
| `GET/POST` | `/edit_news/<int:news_id>` | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ | –ê–¥–º–∏–Ω |
| `POST` | `/delete_news/<int:news_id>` | –£–¥–∞–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ | –ê–¥–º–∏–Ω |

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

#### `equipment` - –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¢–ú–¶
```sql
id              INT PRIMARY KEY AUTO_INCREMENT
orgid           INT (FK -> org.id)
placesid        INT (FK -> places.id)
usersid         INT (FK -> users.id)  -- –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –ú–û–õ
nomeid          INT (FK -> nome.id)
buhname         VARCHAR(255)          -- –ë—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
datepost        DATETIME              -- –î–∞—Ç–∞ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è
cost            DECIMAL(12,2)         -- –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
currentcost     DECIMAL(12,2)         -- –¢–µ–∫—É—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
sernum          VARCHAR(100)         -- –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä
invnum          VARCHAR(100)         -- –ò–Ω–≤–µ–Ω—Ç–∞—Ä–Ω—ã–π –Ω–æ–º–µ—Ä
department_id   INT (FK -> department.id)
active          BOOLEAN
os              BOOLEAN               -- –û—Å–Ω–æ–≤–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ
comment         TEXT
photo           VARCHAR(255)
-- ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
```

#### `nome` - –ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞ –¢–ú–¶
```sql
id              INT PRIMARY KEY AUTO_INCREMENT
groupid         INT (FK -> group_nome.id)
vendorid        INT (FK -> vendor.id)
name            VARCHAR(255)
photo           VARCHAR(255)
is_composite    BOOLEAN               -- –°–æ—Å—Ç–∞–≤–Ω–æ–µ –¢–ú–¶ (–º–æ–∂–µ—Ç –∏–º–µ—Ç—å –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ)
comment         TEXT
```

#### `users` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
```sql
id              INT PRIMARY KEY
login           VARCHAR(50) UNIQUE
password        VARCHAR(40)          -- SHA1 —Ö–µ—à
salt            VARCHAR(10)
mode            INT                   -- 1=–ê–¥–º–∏–Ω, 0=–û–±—ã—á–Ω—ã–π
active          BOOLEAN
orgid           INT (FK -> org.id)
```

#### `users_roles` - –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```sql
userid          INT (FK -> users.id)
role            INT                   -- 1=–ú–û–õ, 2=–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
```

#### `equipment_temp_usage` - –í—Ä–µ–º–µ–Ω–Ω–∞—è –≤—ã–¥–∞—á–∞ –¢–ú–¶
```sql
id              INT PRIMARY KEY AUTO_INCREMENT
equipment_id    INT (FK -> equipment.id)
user_temp_id    INT (FK -> users.id)  -- –ö–æ–º—É –≤—ã–¥–∞–Ω–æ
mol_userid      INT (FK -> users.id)  -- –ö—Ç–æ –≤—ã–¥–∞–ª (–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –ú–û–õ)
dt_start        DATETIME
dt_end          DATETIME
returned        BOOLEAN
comment         TEXT
```

#### `equipment_comments` - –ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
```sql
id              INT PRIMARY KEY AUTO_INCREMENT
equipment_id   INT (FK -> equipment.id)
comment        TEXT
created_at     DATETIME
created_by     INT (FK -> users.id)
```

### –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

```
Category
  ‚îî‚îÄ‚îÄ GroupNome
      ‚îî‚îÄ‚îÄ Nome
          ‚îî‚îÄ‚îÄ Equipment
              ‚îú‚îÄ‚îÄ AppComponents (–∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ)
              ‚îú‚îÄ‚îÄ EquipmentTempUsage (–≤—Ä–µ–º–µ–Ω–Ω–∞—è –≤—ã–¥–∞—á–∞)
              ‚îî‚îÄ‚îÄ EquipmentComments (–∏—Å—Ç–æ—Ä–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤)

Users
  ‚îú‚îÄ‚îÄ UsersRoles (—Ä–æ–ª–∏)
  ‚îú‚îÄ‚îÄ UsersProfile (–ø—Ä–æ—Ñ–∏–ª—å)
  ‚îî‚îÄ‚îÄ Equipment (–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –ú–û–õ)

Org
  ‚îî‚îÄ‚îÄ Users
      ‚îî‚îÄ‚îÄ Equipment

Department
  ‚îî‚îÄ‚îÄ Equipment
```

---

## üë• –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –∏ –¥–æ—Å—Ç—É–ø–æ–≤

### –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

| –†–æ–ª—å | ID | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ |
|------|-----|-----------|---------------|
| **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** | `mode=1` | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø | –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º –¢–ú–¶ |
| **–ú–û–õ** (–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –õ–∏—Ü–æ) | `role=1` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¢–ú–¶ | –í—ã–¥–∞—á–∞/–ø—Ä–∏–µ–º –¢–ú–¶, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤–æ–∏—Ö –¢–ú–¶, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–≤–æ–∏–º –¢–ú–¶ |
| **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** | `role=2` | –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ | –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –¢–ú–¶, –ø–æ–ª—É—á–µ–Ω–∏–µ –¢–ú–¶ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |

### –ú–∞—Ç—Ä–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–∞

| –§—É–Ω–∫—Ü–∏—è | –ê–¥–º–∏–Ω | –ú–û–õ | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
|---------|-------|-----|--------------|
| –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –¢–ú–¶ | ‚úÖ | ‚ùå | ‚ùå |
| –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –¢–ú–¶ | ‚úÖ | ‚úÖ | ‚úÖ |
| –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¢–ú–¶ | ‚úÖ | ‚úÖ | ‚ùå |
| –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¢–ú–¶ | ‚úÖ | ‚úÖ (—Å–≤–æ–∏) | ‚ùå |
| –£–¥–∞–ª–µ–Ω–∏–µ –¢–ú–¶ | ‚úÖ | ‚ùå | ‚ùå |
| –í—ã–¥–∞—á–∞ –¢–ú–¶ | ‚úÖ | ‚úÖ | ‚ùå |
| –ü–æ–ª—É—á–µ–Ω–∏–µ –¢–ú–¶ | ‚ùå | ‚ùå | ‚úÖ |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ | ‚úÖ | ‚ùå | ‚ùå |
| –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–≤—Å–µ) | ‚úÖ | ‚ùå | ‚ùå |
| –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Å–≤–æ—è) | ‚úÖ | ‚úÖ | ‚úÖ |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–æ–π | ‚úÖ | ‚úÖ (—á–∞—Å—Ç–∏—á–Ω–æ) | ‚ùå |

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –≤ –∫–æ–¥–µ

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
is_admin = current_user.mode == 1

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –ú–û–õ
is_mol = current_user_has_role(1)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
is_user = current_user_has_role(2)

# –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∑–∞—â–∏—Ç—ã —Ä–æ—É—Ç–æ–≤
@login_required
def protected_route():
    if not is_admin:
        abort(403)
    # ...
```

---

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Production Setup —Å Gunicorn

#### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Gunicorn

```bash
pip install gunicorn
```

#### 2. –°–æ–∑–¥–∞–Ω–∏–µ systemd service

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/etc/systemd/system/flask-tmc.service`:

```ini
[Unit]
Description=Flask TMC Application
After=network.target mysql.service

[Service]
User=www-data
Group=www-data
WorkingDirectory=/home/flask_tmc_app
Environment="PATH=/home/flask_tmc_app/venv/bin"
ExecStart=/home/flask_tmc_app/venv/bin/gunicorn \
    --workers 4 \
    --bind 127.0.0.1:5000 \
    --timeout 120 \
    --access-logfile /var/log/flask-tmc/access.log \
    --error-logfile /var/log/flask-tmc/error.log \
    app:app

[Install]
WantedBy=multi-user.target
```

#### 3. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤

```bash
sudo mkdir -p /var/log/flask-tmc
sudo chown www-data:www-data /var/log/flask-tmc
```

#### 4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º

```bash
# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ systemd
sudo systemctl daemon-reload

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
sudo systemctl start flask-tmc

# –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
sudo systemctl enable flask-tmc

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status flask-tmc

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
sudo journalctl -u flask-tmc -f
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Gunicorn

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `gunicorn_config.py`:

```python
# gunicorn_config.py
bind = "127.0.0.1:5000"
workers = 4
worker_class = "sync"
worker_connections = 1000
timeout = 120
keepalive = 5
max_requests = 1000
max_requests_jitter = 50
preload_app = True
```

–ó–∞–ø—É—Å–∫:
```bash
gunicorn -c gunicorn_config.py app:app
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# –í app.py
import logging
from logging.handlers import RotatingFileHandler

if not app.debug:
    file_handler = RotatingFileHandler(
        '/var/log/flask-tmc/app.log',
        maxBytes=10240000,
        backupCount=10
    )
    file_handler.setFormatter(logging.Formatter(
        '%(asctime)s %(levelname)s: %(message)s [in %(pathname)s:%(lineno)d]'
    ))
    file_handler.setLevel(logging.INFO)
    app.logger.addHandler(file_handler)
    app.logger.setLevel(logging.INFO)
    app.logger.info('Flask TMC startup')
```

---

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–û—à–∏–±–∫–∞:** `OperationalError: (2003, "Can't connect to MySQL server")`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ MySQL
sudo systemctl status mysql

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
mysql -u tmc_user -p -h localhost webuseorg3

# –ü—Ä–æ–≤–µ—Ä–∫–∞ DATABASE_URL –≤ .env
echo $DATABASE_URL
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º

**–û—à–∏–±–∫–∞:** `PermissionError: [Errno 13] Permission denied`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
ls -la /var/www/html/photos

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—Ä–∞–≤
sudo chown -R www-data:www-data /var/www/html/photos
sudo chmod -R 755 /var/www/html/photos
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å Nginx

**–û—à–∏–±–∫–∞:** `502 Bad Gateway`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ
curl http://127.0.0.1:5000

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Nginx
sudo tail -f /var/log/nginx/error.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nginx -t
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Å—Å–∏—è–º–∏

**–û—à–∏–±–∫–∞:** –°–µ—Å—Å–∏–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `SECRET_KEY` –≤ `.env`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ cookies —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `SESSION_COOKIE_SECURE` –∏ `SESSION_COOKIE_HTTPONLY`

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∞–π–ª–æ–≤

**–û—à–∏–±–∫–∞:** –§–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å < MAX_UPLOAD_SIZE)
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ ALLOWED_EXTENSIONS)
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∑–∞–≥—Ä—É–∑–∫–∏
ls -la /var/www/html/photos
```

### –û—Ç–ª–∞–¥–∫–∞

```python
# –í–∫–ª—é—á–µ–Ω–∏–µ debug —Ä–µ–∂–∏–º–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!)
app.config['DEBUG'] = True

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤
app.config['SQLALCHEMY_ECHO'] = True
```

---

## üíª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
flask-tmc-app/
‚îú‚îÄ‚îÄ app.py                      # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (3244 —Å—Ç—Ä–æ–∫–∏)
‚îú‚îÄ‚îÄ models.py                   # –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (SQLAlchemy)
‚îú‚îÄ‚îÄ .env                        # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è)
‚îú‚îÄ‚îÄ .gitignore                  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ requirements.txt            # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ README.md                   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ COMPATIBILITY.md            # –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫
‚îÇ
‚îú‚îÄ‚îÄ static/                     # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ css/                    # –°—Ç–∏–ª–∏ CSS
‚îÇ   ‚îú‚îÄ‚îÄ js/                     # JavaScript —Ñ–∞–π–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ uploads/                 # –°–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ /var/www/html/photos/
‚îÇ
‚îî‚îÄ‚îÄ templates/                  # –®–∞–±–ª–æ–Ω—ã Jinja2
    ‚îú‚îÄ‚îÄ base.html               # –ë–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω (—Å —Å–∞–π–¥–±–∞—Ä–æ–º)
    ‚îú‚îÄ‚îÄ index.html              # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    ‚îú‚îÄ‚îÄ login.html               # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
    ‚îú‚îÄ‚îÄ add_tmc.html            # –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¢–ú–¶
    ‚îú‚îÄ‚îÄ edit_tmc.html           # –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¢–ú–¶
    ‚îú‚îÄ‚îÄ info_tmc.html           # –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¢–ú–¶
    ‚îú‚îÄ‚îÄ my_temp_tmc.html        # –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¢–ú–¶
    ‚îú‚îÄ‚îÄ my_friends.html         # –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π
    ‚îú‚îÄ‚îÄ stats.html              # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    ‚îú‚îÄ‚îÄ all_moves.html          # –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π
    ‚îú‚îÄ‚îÄ my_moves.html           # –ú–æ–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
    ‚îî‚îÄ‚îÄ ...                     # –î—Ä—É–≥–∏–µ —à–∞–±–ª–æ–Ω—ã
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### Context Processors

–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–æ –≤—Å–µ—Ö —à–∞–±–ª–æ–Ω–∞—Ö:
- `user_login` - –ª–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `user_photo` - —Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `tmc_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¢–ú–¶
- `total_cost` - –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
- `is_admin` - —Ñ–ª–∞–≥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- `is_mol` - —Ñ–ª–∞–≥ –ú–û–õ
- `user_org_name` - –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

#### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è (SHA1)
def check_password(password, salt, stored_hash)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
def current_user_has_role(role_id)
def user_has_role(user_id, role_id)

# –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
def allowed_file(filename)
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
export FLASK_ENV=development
export FLASK_DEBUG=1
python3 app.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
python3 -m py_compile app.py models.py
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `migrations/`. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–æ–¥–µ–ª–µ–π —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –≤ —ç—Ç–æ–π –ø–∞–ø–∫–µ.

**–ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π:**
```bash
# –ò–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
python3 migrations/migrate_name.py
```

**–ü—Ä–∏–º–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏:**
```python
# migrations/migrate_example.py
import sys
import os
from sqlalchemy import text

sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))
from app import app, db

def migrate():
    with app.app_context():
        db.session.execute(text("ALTER TABLE equipment ADD COLUMN new_field VARCHAR(255)"))
        db.session.commit()

if __name__ == '__main__':
    migrate()
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. `migrations/README.md` –∏ `PROJECT_STRUCTURE.md`.

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Flask Documentation](https://flask.palletsprojects.com/)
- [SQLAlchemy Documentation](https://docs.sqlalchemy.org/)
- [Flask-SQLAlchemy Documentation](https://flask-sqlalchemy.palletsprojects.com/)
- [Flask-Login Documentation](https://flask-login.readthedocs.io/)

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –î–µ–π—Å—Ç–≤–∏–µ | –ö–æ–º–∞–Ω–¥–∞ |
|----------|---------|
| **–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ** | `source venv/bin/activate` |
| **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (dev)** | `python3 app.py` |
| **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (prod)** | `gunicorn -w 4 -b 127.0.0.1:5000 app:app` |
| **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å MySQL** | `sudo systemctl status mysql` |
| **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Nginx** | `sudo systemctl restart nginx` |
| **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ Nginx** | `sudo nginx -t` |
| **–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ Flask** | `tail -f /var/log/flask-tmc/error.log` |
| **–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ Nginx** | `sudo tail -f /var/log/nginx/error.log` |
| **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞** | `sudo systemctl status flask-tmc` |
| **–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ** | `deactivate` |

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ß–µ–∫-–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- [ ] `.env` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore`
- [ ] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞–¥–µ–∂–Ω—ã–π `SECRET_KEY` (32+ —Å–∏–º–≤–æ–ª–æ–≤)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–∞—Ä–æ–ª–∏ –¥–ª—è MySQL (—Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω firewall (–æ—Ç–∫—Ä—ã—Ç—ã —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã)
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTTPS (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
- [ ] –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`pip list --outdated`)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω Gunicorn –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (–Ω–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä Flask)
- [ ] –û–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞—É–¥–∏—Ç–∞
- [ ] –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- ‚ùó **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä Flask –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ**
- üîê **–•—Ä–∞–Ω–∏—Ç–µ `.env` –≤–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è**
- üîí **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** (–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç)
- üõ°Ô∏è **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ firewall** (UFW, iptables)
- üìù **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- üîÑ **–û–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** —Ä–µ–≥—É–ª—è—Ä–Ω–æ

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞

1. **–õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   ```bash
   tail -f /var/log/flask-tmc/error.log
   ```

2. **–õ–æ–≥–∏ Nginx:**
   ```bash
   sudo tail -f /var/log/nginx/flask-tmc-error.log
   ```

3. **–õ–æ–≥–∏ systemd:**
   ```bash
   sudo journalctl -u flask-tmc -f
   ```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –≤ `.env`
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** –∫ —Ñ–∞–π–ª–∞–º
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤** (MySQL, Nginx, Gunicorn)

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º —Å [webuseorg3](https://github.com/donpadlo/webuseorg3).

---

**–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è —É—á–µ—Ç–∞ –¢–ú–¶**

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025*
