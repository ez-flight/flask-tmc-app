<!-- templates/list_by_nome.html -->
{% extends "base.html" %}
{% block title %}–î–µ—Ç–∞–ª–∏: {{ nome.name }}{% endblock %}
{% block content %}
<h1>–î–µ—Ç–∞–ª–∏ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è: "{{ nome.name }}"</h1>
<p class="lead">–í—Å–µ–≥–æ: {{ tmc_list|length }} —à—Ç.</p>
<a href="{{ url_for('index') }}" class="btn btn-secondary mb-3">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–≤–æ–¥–Ω–æ–º—É —Å–ø–∏—Å–∫—É</a>
<a href="{{ url_for('add_tmc', nome_id=nome.id) }}" class="btn btn-primary mb-3">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –¢–ú–¶</a>
<a href="{{ url_for('bulk_edit_nome', nome_id=nome.id) }}" class="btn btn-primary mb-3">–ì—Ä—É–ø–ø–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
{% if tmc_list %}
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>–ú–µ—Å—Ç–æ</th>
                    <th>–°–µ—Ä–∏–π–Ω—ã–π ‚Ññ</th>
                    <th>–ò–Ω–≤. ‚Ññ</th>
                    <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                    <th>–°—Ä–æ–∫ —Å–ª—É–∂–±—ã –¥–æ</th>
                    <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                    <th>–ü–∞—Å–ø–æ—Ä—Ç</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for tmc in tmc_list %}
                <tr>
                    <td>{{ tmc.places.name if tmc.places else '‚Äî' }}</td>
                    <td>{{ tmc.sernum or '‚Äî' }}</td>
                    <td>{{ tmc.invnum or '‚Äî' }}</td>
                    <td>{{ "{:,.2f}".format(tmc.cost) }} —Ä—É–±.</td>
                    <td
                        {% if tmc.dtendlife %}
                            {% set today = now_date or date.today() %}
                            {% if tmc.dtendgar and tmc.dtendgar >= today %}
                                style="background-color: #d4edda; color: #155724;"  <!-- –∑–µ–ª—ë–Ω—ã–π -->
                            {% elif tmc.dtendlife >= today %}
                                style="background-color: #fff3cd; color: #856404;"  <!-- –∂—ë–ª—Ç—ã–π -->
                            {% else %}
                                style="background-color: #f8d7da; color: #721c24;"  <!-- –∫—Ä–∞—Å–Ω—ã–π -->
                            {% endif %}
                        {% endif %}
                    >
                        {{ tmc.dtendlife.strftime('%d.%m.%Y') if tmc.dtendlife else '‚Äî' }}
                    </td>
                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                        title="{{ tmc.comment or '' }}">
                        {{ tmc.comment or '‚Äî' }}
                    </td>
                    <td>
                        {% if tmc.passport_filename %}
                            <a href="{{ url_for('static', filename='uploads/' + tmc.passport_filename) }}" target="_blank">
                                üìÑ –ü–∞—Å–ø–æ—Ä—Ç 
                            </a>
                        {% else %}
                            <em>–Ω–µ—Ç</em>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('info_tmc', tmc_id=tmc.id) }}" class="btn btn-info btn-sm">–ü–æ–¥—Ä–æ–±–Ω–æ</a>
                        <a href="{{ url_for('edit_tmc', tmc_id=tmc.id) }}" class="btn btn-sm btn-outline-secondary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <p>–ù–µ—Ç –¢–ú–¶ —ç—Ç–æ–≥–æ —Ç–∏–ø–∞.</p>
{% endif %}
{% endblock %}