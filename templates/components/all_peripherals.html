<!-- templates/components/all_peripherals.html -->
{% extends "base.html" %}
{% block title %}Компьютерная периферия{% endblock %}
{% block content %}
<div class="page-header">
    <div>
        <h1>Компьютерная периферия</h1>
        <p class="text-muted mb-0">Всего единиц: {{ tmc_count }} шт. | Общая стоимость: {{ "{:,.2f}".format(total_cost) }} руб.</p>
    </div>
    <div class="user-info">
        <span class="text-muted">Вы вошли как: <strong>{{ user_login }}</strong></span>
        <a href="{{ url_for('index') }}" class="btn btn-secondary btn-sm">
            <i class="bi bi-arrow-left me-1"></i>На главную
        </a>
    </div>
</div>

<!-- Фильтры -->
<form method="GET">
    <div class="row mb-3">
        {% if is_admin %}
        <div class="col-md-4">
            <label for="userSelect" class="form-label">Фильтр по пользователю:</label>
            <select id="userSelect" name="user_id" class="form-select" onchange="this.form.submit()">
                <option value="">Все пользователи</option>
                {% for user in all_users %}
                    <option value="{{ user.id }}" {% if filter_user_id == user.id %}selected{% endif %}>
                        {{ user.login }}
                    </option>
                {% endfor %}
            </select>
        </div>
        {% endif %}
        <div class="col-md-4">
            <label for="departmentSelect" class="form-label">Фильтр по отделу:</label>
            <select id="departmentSelect" name="department_id" class="form-select" onchange="this.form.submit()">
                <option value="">Все отделы</option>
                {% for dept in all_departments %}
                    <option value="{{ dept.id }}" {% if filter_department_id == dept.id %}selected{% endif %}>
                        {{ dept.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4">
            <label for="categorySelect" class="form-label">Фильтр по категории:</label>
            <select id="categorySelect" name="category_id" class="form-select" onchange="this.form.submit()">
                <option value="">Все категории</option>
                {% for cat in all_categories %}
                    <option value="{{ cat.id }}" {% if filter_category_id == cat.id %}selected{% endif %}>
                        {{ cat.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
    </div>
</form>

<!-- Информация для администраторов -->
{% if is_admin %}
<div class="alert alert-success d-flex align-items-center mb-3" role="alert">
    <i class="bi bi-shield-check me-2"></i>
    <span>Вы администратор. У вас полный доступ к компьютерной периферии.</span>
</div>
{% endif %}

<!-- Кнопки действий -->
<div class="mb-3">
    {% if is_admin %}
        <a href="{{ url_for('peripherals') }}" class="btn btn-primary me-2">
            <i class="bi bi-keyboard me-1"></i>Компьютерная периферия
        </a>
        <a href="{{ url_for('all_tmc') }}" class="btn btn-outline-primary me-2">
            <i class="bi bi-bar-chart me-1"></i>Основные средства
        </a>
        <a href="{{ url_for('add_nome') }}" class="btn btn-success me-2">
            <i class="bi bi-plus me-1"></i>Группа ТМЦ
        </a>
        <a href="{{ url_for('add_peripheral') }}" class="btn btn-success me-2">
            <i class="bi bi-plus-circle me-1"></i>Добавить периферию
        </a>
    {% endif %}
    <a href="{{ url_for('index') }}" class="btn btn-secondary">
        <i class="bi bi-arrow-left me-1"></i>Назад
    </a>
</div>

{% if selected_group_name %}
<!-- Заголовок выбранной группы -->
<div class="alert alert-info mb-3">
    <i class="bi bi-folder me-2"></i>
    <strong>Группа:</strong> {{ selected_group_name }}
        <a href="{{ url_for('peripherals') }}" class="btn btn-sm btn-outline-secondary ms-2">
        <i class="bi bi-arrow-left me-1"></i>Назад к группам
    </a>
</div>
{% endif %}

<!-- Таблица периферии -->
<div class="card shadow-sm">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th scope="col" style="width: 80px;">Фото</th>
                        <th scope="col">
                            {% if filter_group_id %}
                                Тип периферии
                            {% else %}
                                Группа периферии
                            {% endif %}
                        </th>
                        <th scope="col" style="width: 100px;">Кол-во</th>
                        <th scope="col" style="width: 40px;"></th>
                    </tr>
                </thead>
                <tbody>
                    {% if grouped_tmc %}
                        {% for item in grouped_tmc %}
                        {% if not filter_group_id and item.is_group is defined and item.is_group %}
                            <!-- Если группа не выбрана, показываем группы - вся строка кликабельна -->
                            <tr style="cursor: pointer;" onclick="window.location.href='{{ url_for('peripherals', group_id=item.nomeid) }}'">
                        {% else %}
                            <!-- Обычный просмотр по наименованию - вся строка кликабельна -->
                            <tr style="cursor: pointer;" onclick="window.location.href='{{ url_for('list_by_nome', nome_id=item.nomeid) }}'">
                        {% endif %}
                            <td>
                                {% if item.nome_photo %}
                                    <img src="{{ url_for('static', filename='uploads/' + item.nome_photo) }}" 
                                         alt="Фото {{ item.nome_name }}" 
                                         class="img-fluid rounded" 
                                         style="max-height: 60px; max-width: 60px; object-fit: cover;">
                                {% else %}
                                    <div class="d-flex justify-content-center align-items-center bg-light rounded" 
                                         style="width: 60px; height: 60px; border: 1px solid #ddd;">
                                        <i class="bi bi-{% if filter_group_id %}keyboard{% else %}folder{% endif %}" style="font-size: 1.5rem; color: #6c757d;"></i>
                                    </div>
                                {% endif %}
                            </td>
                            <td>
                                <strong>{{ item.nome_name }}</strong>
                                {% if not filter_group_id and item.total_cost is defined and item.total_cost %}
                                    <br><small class="text-muted">Стоимость: {{ "{:,.2f}".format(item.total_cost).replace(',', ' ') }} ₽</small>
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge bg-primary">{{ item.quantity }}</span>
                            </td>
                            <td>
                                <i class="bi bi-chevron-right text-muted"></i>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="4" class="text-center py-5">
                                <div class="text-muted">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-puzzle mb-2" viewBox="0 0 16 16">
                                        <path d="M8.864.02a.493.493 0 0 0-.728 0l-5.5 7.07A2.5 2.5 0 0 0 3 12h10a2.5 2.5 0 0 0 .364-4.93l-5.5-7.07zM11 10.5a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1 0-1h5a.5.5 0 0 1 .5.5zm-5-4a.5.5 0 0 1-.5.5H4.293l2.854-3.656a.5.5 0 0 1 .764-.035L8 3.5V5.5z"/>
                                        <path d="M12.5.373a.5.5 0 0 1 .602.025l1.5 2a.5.5 0 0 1-.728.643L12.5 1.268V.373zM2.5.373v.895L1.123 3.04a.5.5 0 0 1-.728-.643l1.5-2a.5.5 0 0 1 .602-.024zM15 10.5h.5a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5H15v-3zm-14 0H.5a.5.5 0 0 0-.5.5v2a.5.5 0 0 0 .5.5H1v-3zm13.5-9a.5.5 0 0 0-.5-.5h-11a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5v-1z"/>
                                    </svg>
                                    <h5>Нет компьютерной периферии</h5>
                                    <p class="mb-0">Нет данных, соответствующих выбранным фильтрам.</p>
                                </div>
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    .table-hover > tbody > tr:hover {
        background-color: #f8f9fa;
        transition: background-color 0.2s;
    }
    .table th {
        font-weight: 600;
    }
    .table-light th {
        background-color: #f8f9fa;
        border-bottom: 2px solid #e9ecef;
    }
    .btn-primary {
        background-color: #0d6efd;
        border-color: #0d6efd;
    }
    .btn-primary:hover {
        background-color: #0b5ed7;
        border-color: #0a58ca;
    }
    .card {
        border: none;
    }
    /* Стили для кликабельных строк */
    tbody tr[onclick] {
        transition: background-color 0.2s ease;
    }
    tbody tr[onclick]:hover {
        background-color: #f8f9fa !important;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    tbody tr[onclick]:active {
        background-color: #e9ecef !important;
    }
</style>
{% endblock %}