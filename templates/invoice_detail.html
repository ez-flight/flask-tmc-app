<!-- templates/invoice_detail.html -->
{% extends "base.html" %}
{% block title %}–ù–∞–∫–ª–∞–¥–Ω–∞—è ‚Ññ{{ invoice.invoice_number }}{% endblock %}
{% block content %}
<h1>–ù–∞–∫–ª–∞–¥–Ω–∞—è ‚Ññ{{ invoice.invoice_number }} –æ—Ç {{ invoice.invoice_date.strftime('%d.%m.%Y') }}</h1>

<!-- –ù–û–í–´–ô –ë–õ–û–ö -->
<div class="alert alert-info">
  <strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¢–ú–¶:</strong> {{ tmc_count }} —à—Ç.<br>
  <strong>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {{ "{:,.2f}".format(total_cost)|replace(',', ' ') }} ‚ÇΩ
</div>
<div class="mb-3">
  <a href="javascript:history.back()" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
  <a href="{{ url_for('edit_invoice', invoice_id=invoice.id) }}" class="btn btn-warning">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
  <form method="POST" action="{{ url_for('delete_invoice', invoice_id=invoice.id) }}" style="display:inline;" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –Ω–∞–∫–ª–∞–¥–Ω—É—é? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.');">
    <button type="submit" class="btn btn-danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
  </form>
  {% if invoice.pdf_path %}
    <a href="{{ url_for('static', filename=invoice.pdf_path.split('/uploads/')[-1]) }}" target="_blank" class="btn btn-primary">üìÑ –û—Ç–∫—Ä—ã—Ç—å PDF</a>
  {% endif %}
</div>

<div class="card mb-3">
  <div class="card-body">
    <h5>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
    <p><strong>–¢–∏–ø:</strong> {{ invoice.type }}</p>
    <p><strong>–û—Ç–¥–µ–ª:</strong> {{ invoice.department.name if invoice.department else '‚Äî' }}</p>

    <h5>–£—á–∞—Å—Ç–Ω–∏–∫–∏</h5>
    {% if invoice.type == '–°–∫–ª–∞–¥-–ú–û–õ' %}
      <p><strong>–û—Ç–∫—É–¥–∞ (—Å–∫–ª–∞–¥):</strong> {{ invoice.from_knt.name if invoice.from_knt else '‚Äî' }}</p>
      <p><strong>–ö–æ–º—É (–ú–û–õ):</strong> {{ invoice.to_user.login if invoice.to_user else '‚Äî' }}</p>
    {% elif invoice.type == '–ú–û–õ-–°–∫–ª–∞–¥' %}
      <p><strong>–û—Ç –∫–æ–≥–æ (–ú–û–õ):</strong> {{ invoice.from_user.login if invoice.from_user else '‚Äî' }}</p>
      <p><strong>–ö—É–¥–∞ (—Å–∫–ª–∞–¥):</strong> {{ invoice.to_knt.name if invoice.to_knt else '‚Äî' }}</p>
    {% elif invoice.type == '–ú–û–õ-–ú–û–õ' %}
      <p><strong>–û—Ç –∫–æ–≥–æ:</strong> {{ invoice.from_user.login if invoice.from_user else '‚Äî' }}</p>
      <p><strong>–ö–æ–º—É:</strong> {{ invoice.to_user.login if invoice.to_user else '‚Äî' }}</p>
    {% endif %}
  </div>
</div>

<h3>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –≤ –Ω–∞–∫–ª–∞–¥–Ω–æ–π</h3>
{% if invoice.invoice_equipment %}
  <div class="table-responsive">
    <table class="table table-bordered table-striped">
      <thead class="table-light">
        <tr>
          <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
          <th>–°–µ—Ä–∏–π–Ω—ã–π ‚Ññ</th>
          <th>–ò–Ω–≤–µ–Ω—Ç–∞—Ä–Ω—ã–π ‚Ññ</th>
          <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>  <!-- ‚Üê –î–û–ë–ê–í–õ–ï–ù–ê –°–¢–û–ò–ú–û–°–¢–¨ -->
          <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
        </tr>
      </thead>
      <tbody>
        {% for ie in invoice.invoice_equipment %}
          <tr style="cursor: pointer;" onclick="window.location='{{ url_for('info_tmc', tmc_id=ie.equipment.id) }}'">
            <td>{{ ie.equipment.nome.name if ie.equipment.nome else ie.equipment.buhname }}</td>
            <td>{{ ie.equipment.sernum or '‚Äî' }}</td>
            <td>{{ ie.equipment.invnum or '‚Äî' }}</td>
            <td>{{ "{:,.2f}".format(ie.equipment.cost) }} ‚ÇΩ</td>  <!-- ‚Üê –î–û–ë–ê–í–õ–ï–ù–û –ó–ù–ê–ß–ï–ù–ò–ï -->
            <td>{{ ie.equipment.comment or '‚Äî' }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <p class="text-muted">–ù–µ—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.</p>
{% endif %}

{% endblock %}