<!-- templates/manage_users.html -->
{% extends "base.html" %}
{% block title %}Управление пользователями{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3">Управление пользователями</h1>
    <div class="d-flex align-items-center">
        <span class="me-3">Вы вошли как: <strong>{{ user_login }}</strong></span>
        <a href="{{ url_for('index') }}" class="btn btn-secondary btn-sm">← На главную</a>
    </div>
</div>

{% if is_admin %}
<div class="alert alert-info d-flex align-items-center" role="alert">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-shield-check me-2" viewBox="0 0 16 16">
        <path d="M5.338 1.59a6.7 6.7 0 0 1 .683-1.02A12 12 0 0 1 7.875 0q.294.001.59.036a12.04 12.04 0 0 1 2.426.764c.59.272 1.154.59 1.683 1.02l.002.001.27.307c.004.004.008.009.013.015a6.85 6.85 0 0 1 1.11 1.505c.583 1.35 1.173 3.162 1.173 5.06 0 1.898-.59 3.71-1.173 5.06a6.7 6.7 0 0 1-1.11 1.505c-.004.005-.008.01-.013.015l-.27.307a.99.99 0 0 1-.013.015c-.005.005-.009.009-.014.013l-.08.068-.25.205c-.075.06-.16.09-.26.09z"/>
        <path d="M12.64 10.051a.717.717 0 0 1-.909-.53 1.5 1.5 0 0 0-2.45-.817.72.72 0 0 1-1.165-.891 3 3 0 0 1 4.602-1.222.717.717 0 0 1 .08 1.208c-1.07.757-1.837 2.254-1.837 4.284 0 1.483.478 2.758 1.18 3.67a.72.72 0 0 1-.598 1.18 4.244 4.244 0 0 1-2.276-.692 6.9 6.9 0 0 1-2.81-2.586.72.72 0 0 1 .788-1.07c.354.374.827.672 1.403.844 1.25.36 2.5-.154 2.5-1.48 0-1.623-1.513-2.717-2.5-2.717a1.5 1.5 0 0 0-1.5 1.5c0 .278.044.55.128.803a.717.717 0 0 1-1.27.85l-.02-.02a1.5 1.5 0 0 0-1.08-1.287c-.897-.23-1.82-.448-2.75-.653a.72.72 0 0 1 .321-1.397c.94.207 1.875.427 2.824.665a2.5 2.5 0 0 1 2.25-1.875c1.56 0 2.91.97 3.39 2.354a.72.72 0 0 1-.44.926 1.5 1.5 0 0 0 .009 2.04c-.586.643-1.367.988-2.179.988-1.573 0-2.875-1.165-2.875-2.5 0-.79.35-1.513.904-2.037a.72.72 0 0 1 1.057.054c.312.35.735.56 1.215.56.82 0 1.558-.53 1.852-1.315a.717.717 0 0 1 1.32.34z"/>
    </svg>
    Вы администратор. У вас полный доступ к системе.
</div>
{% endif %}

<div class="card shadow-sm">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Логин</th>
                        <th scope="col">ФИО</th>
                        <th scope="col">Должность</th>
                        <th scope="col">Админ</th>
                        <th scope="col">Статус</th>
                        <th scope="col">Фото</th>
                        <th scope="col" class="text-end">Действия</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in all_users %}
                    <tr {% if user.id == current_user.id %}class="table-primary"{% endif %}>
                        <td>{{ user.id }}</td>
                        <td>
                            {{ user.login }}
                            {% if user.id == current_user.id %}
                                <span class="badge bg-info text-white ms-1">Вы</span>
                            {% endif %}
                        </td>
                        <td>{{ user_profiles.get(user.id).fio if user_profiles.get(user.id) else 'N/A' }}</td>
                        <td>{{ post_dict.get(user.id) if post_dict.get(user.id) else 'N/A' }}</td>
                        <td>
                            {% if user.mode == 1 %}
                                <span class="badge bg-success">Да</span>
                            {% elif user.mode == 0 %}

                            {% else %}
                                <span class="badge bg-warning">Неизвестно</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if user.active %}
                                <span class="badge bg-success">Активен</span>
                            {% else %}
                                <span class="badge bg-danger">Неактивен</span>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            {% if user_profiles.get(user.id) and user_profiles.get(user.id).jpegphoto and user_profiles.get(user.id).jpegphoto != 'noimage.jpg' %}
                                <img src="{{ url_for('static', filename='uploads/' + user_profiles.get(user.id).jpegphoto) }}" 
                                     alt="Фото {{ user.login }}" 
                                     class="rounded-circle border" 
                                     width="40" height="40"
                                     style="object-fit: cover;">
                            {% else %}
                                <div class="d-flex justify-content-center align-items-center bg-light rounded-circle border" style="width: 40px; height: 40px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                                        <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001.246-.154.986-.832 1.664-.677.678-1.419 1.251-2.193 1.587-.335.141-.687.227-1.048.236-.36.008-.72-.039-1.06-.163-.339-.124-.649-.316-.904-.592-.263-.285-.45-.643-.552-1.023-.1-.39-.089-.801.03-.988.119-.188.34-.309.56-.362.22-.052.437-.03.635.057.201.088.38.242.52.42.141.179.23.38.265.587.035.208.014.426-.057.634-.071.207-.19.39-.35.55-.16.159-.35.28-.56.36-.21.079-.435.11-.66.091-.225-.02-.44-.083-.63-.187z"/>
                                    </svg>
                                </div>
                            {% endif %}
                        </td>
                        <td class="text-end">
                            <a href="{{ url_for('edit_user', user_id=user.id) }}" 
                               class="btn btn-sm {% if user.id == current_user.id %}btn-primary{% else %}btn-warning{% endif %}">
                                <i class="bi bi-pencil me-1"></i>Редактировать
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {% if all_users|length == 0 %}
        <div class="alert alert-info text-center mt-3" role="alert">
            <i class="bi bi-info-circle me-2"></i>Пользователи не найдены
        </div>
        {% endif %}
    </div>
</div>

<style>
    .table-hover > tbody > tr:hover {
        background-color: #f8f9fa;
        transition: background-color 0.2s;
    }
    .badge {
        font-weight: 500;
    }
    .table th {
        font-weight: 600;
    }
    .table-light th {
        background-color: #f8f9fa;
        border-bottom: 2px solid #e9ecef;
    }
</style>
{% endblock %}