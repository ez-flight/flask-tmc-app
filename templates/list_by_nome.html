<!-- templates/list_by_nome.html -->
{% extends "base.html" %}
{% block title %}Детали: {{ nome.name }}{% endblock %}
{% block content %}
<h1>Детали наименования: "{{ nome.name }}"</h1>
<p class="lead">Всего: {{ tmc_list|length }} шт.</p>
<a href="javascript:history.back()" class="btn btn-secondary mb-3">← Назад</a>
<a href="{{ url_for('add_tmc', nome_id=nome.id) }}" class="btn btn-primary mb-3">Добавить новый ТМЦ</a>
<a href="{{ url_for('bulk_edit_nome', nome_id=nome.id) }}" class="btn btn-primary mb-3">Групповое редактирование</a>

{% if nome.comment %}
    <div class="alert alert-primary mb-4">
        {{ nome.comment|replace('\n', '<br>')|safe }}
    </div>
{% endif %}

{% if tmc_list %}
<div class="table-responsive">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Фото</th>
                <th>Наименование</th>
                <th>Серийный номер</th>
                <th>Инвентарный номер</th>
                <th>Отдел</th>
                <th>Пользователь</th>
                <th>Дата постановки</th>
                <th>Стоимость</th>
                <th>Статус</th>
                <th>Действия</th> <!-- Новая колонка -->
            </tr>
        </thead>
        <tbody>
            {% for tmc in tmc_list %}
            <tr>
                <td>
                    {% if tmc.photo %}
                        <img src="{{ url_for('static', filename='uploads/' + tmc.photo) }}" width="60" alt="Фото">
                    {% else %}
                        <img src="{{ url_for('static', filename='uploads/noimage.jpg') }}" width="60" alt="Нет фото">
                    {% endif %}
                </td>
                <td>{{ tmc.buhname }}</td>
                <td>{{ tmc.sernum or '—' }}</td>
                <td>{{ tmc.invnum or '—' }}</td>
                <td>{{ tmc.department.name if tmc.department else '—' }}</td>
                <td>{{ tmc.user.login if tmc.user else '—' }}</td>
                <td>{{ tmc.datepost.strftime('%d.%m.%Y') if tmc.datepost else '—' }}</td>
                <td>{{ "{:,.2f}".format(tmc.cost) if tmc.cost else '0.00' }} руб.</td>
                <td>
                    {% if tmc.active %}
                        {% if tmc.repair %}В ремонте{% elif tmc.mode %}На модернизации{% elif tmc.disposed %}Списано{% else %}В эксплуатации{% endif %}
                    {% else %}
                        Неактивно
                    {% endif %}
                </td>
                <td>
                        <a href="{{ url_for('info_tmc', tmc_id=tmc.id) }}" class="btn btn-info btn-sm">Подробно</a>
                </td>
                <td>
                    <!-- Кнопка "Редактировать" -->
                    {% if tmc.os %}
                        <a href="{{ url_for('edit_tmc', tmc_id=tmc.id) }}" class="btn btn-info btn-sm">Редактировать</a>
                    {% else %}
                        <a href="{{ url_for('edit_component', component_id=tmc.id) }}" class="btn btn-info btn-sm">Редактировать</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
    <p>Нет ТМЦ с таким наименованием.</p>
{% endif %}

<!-- Вывод шаблона комплекта (если есть) -->
{% if component_template %}
    <h2>Шаблон комплекта</h2>
    <div class="table-responsive">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Порядок</th>
                    <th>Тип комплектующего</th>
                </tr>
            </thead>
            <tbody>
                {% for comp in component_template %}
                <tr>
                    <td>{{ comp.sort_order }}</td>
                    <td>{{ comp.component_nome.name }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endif %}

{% endblock %}