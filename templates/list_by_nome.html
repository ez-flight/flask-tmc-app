<!-- templates/list_by_nome.html -->
{% extends "base.html" %}
{% block title %}Детали: {{ nome.name }}{% endblock %}
{% block content %}
<div class="page-header">
    <div>
        <h1>Детали наименования: "{{ nome.name }}"</h1>
        <p class="text-muted mb-0">Всего: {{ tmc_list|length }} шт.</p>
    </div>
    <div class="user-info">
        <a href="javascript:history.back()" class="btn btn-secondary btn-sm">
            <i class="bi bi-arrow-left me-1"></i>Назад
        </a>
    </div>
</div>

<div class="mb-3">
    <a href="{{ url_for('add_tmc', nome_id=nome.id) }}" class="btn btn-success me-2">
        <i class="bi bi-plus me-1"></i>Добавить новый ТМЦ
    </a>
    {% if is_admin %}
        <a href="{{ url_for('bulk_edit_nome', nome_id=nome.id) }}" class="btn btn-primary me-2">
            <i class="bi bi-pencil-square me-1"></i>Групповое редактирование
        </a>
    {% endif %}
    {% if is_admin or is_mol %}
        <a href="{{ url_for('edit_nome_group', nome_id=nome.id) }}" class="btn btn-info">
            <i class="bi bi-gear me-1"></i>Редактировать группу ТМЦ
        </a>
    {% endif %}
</div>

{% if nome.comment %}
    <div class="alert alert-primary mb-4">
        {{ nome.comment|replace('\n', '<br>')|safe }}
    </div>
{% endif %}

{% if tmc_list %}
<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th scope="col" style="width: 80px;">Фото</th>
                        <th scope="col">Наименование</th>
                        <th scope="col">Серийный номер</th>
                        <th scope="col">Инвентарный номер</th>
                        <th scope="col">Комментарий</th>
                        <th scope="col">Дата постановки</th>
                        <th scope="col">Стоимость</th>
                        <th scope="col">Статус</th>
                    </tr>
                </thead>
        <tbody>
            {% for tmc in tmc_list %}
            <tr class="clickable-row" onclick="window.location='{{ url_for('info_tmc', tmc_id=tmc.id) }}'" style="cursor: pointer;">
                <td>
                    {% if tmc.photo %}
                        <img src="{{ url_for('static', filename='uploads/' + tmc.photo) }}" 
                             alt="Фото" 
                             class="img-fluid rounded" 
                             style="max-height: 60px; max-width: 60px; object-fit: cover;">
                    {% else %}
                        <img src="{{ url_for('static', filename='uploads/noimage.jpg') }}" 
                             alt="Нет фото" 
                             class="img-fluid rounded" 
                             style="max-height: 60px; max-width: 60px; object-fit: cover;">
                    {% endif %}
                </td>
                <td>{{ tmc.buhname }}</td>
                <td>{{ tmc.sernum or '—' }}</td>
                <td>{{ tmc.invnum or '—' }}</td>
                <td>
                    {% if tmc.comment and tmc.comment.strip() %}
                        <span title="{{ tmc.comment|replace('"', '&quot;') }}" style="display: block; max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                            {{ tmc.comment }}
                        </span>
                    {% else %}
                        <span class="text-muted" style="font-style: italic;">Нет комментария</span>
                    {% endif %}
                </td>
                <td>{{ tmc.datepost.strftime('%d.%m.%Y') if tmc.datepost else '—' }}</td>
                <td>{{ "{:,.2f}".format(tmc.cost) if tmc.cost else '0.00' }} руб.</td>
                <td>
                    {% if tmc.active %}
                        {% if tmc.repair %}
                            <span class="badge bg-warning">В ремонте</span>
                        {% elif tmc.mode %}
                            <span class="badge bg-info">На модернизации</span>
                        {% elif tmc.disposed %}
                            <span class="badge bg-danger">Списано</span>
                        {% else %}
                            <span class="badge bg-success">В эксплуатации</span>
                        {% endif %}
                    {% else %}
                        <span class="badge bg-secondary">Неактивно</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
        </div>
    </div>
</div>
{% else %}
    <div class="card">
        <div class="card-body">
            <div class="empty-state">
                <i class="bi bi-clipboard-data" style="font-size: 3rem;"></i>
                <h5>Нет данных</h5>
                <p class="mb-0">Нет ТМЦ с таким наименованием.</p>
            </div>
        </div>
    </div>
{% endif %}

<!-- Вывод шаблона комплекта (если есть) -->
{% if component_template %}
    <div class="card mt-4">
        <div class="card-header">
            Шаблон комплекта
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th scope="col">Порядок</th>
                            <th scope="col">Тип комплектующего</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for comp in component_template %}
                        <tr>
                            <td>{{ comp.sort_order }}</td>
                            <td>{{ comp.component_nome.name }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endif %}

{% endblock %}