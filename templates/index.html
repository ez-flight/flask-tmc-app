<!-- templates/index.html -->
{% extends "base.html" %}

{% block title %}Список ТМЦ{% endblock %}

{% block content %}
<h1>Список Товарно-Материальных Ценностей</h1>
<a href="{{ url_for('add_tmc') }}" class="btn btn-primary mb-3">Добавить новый ТМЦ</a>
<div class="mb-3">
    <label for="deptFilter" class="form-label">Фильтр по отделу:</label>
    <select class="form-select" id="deptFilter" onchange="location = this.value;">
        <option value="{{ url_for('index') }}">Все отделы</option>
        {% for dept in departments %}
            <option value="{{ url_for('index', dept_id=dept.id) }}" {% if request.args.get('dept_id', type='int') == dept.id %}selected{% endif %}>                {{ dept.name }}
            </option>
        {% endfor %}
    </select>
</div>
{% if tmc_list %}
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Фото</th>
                <th>Наименование</th>
                <th>Серийный номер</th>
                <th>Инв. номер</th>
                <th>Комментарий</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for tmc in tmc_list %}
            <tr>
                <td>{{ tmc.id }}</td>
                <td>
                    {% if tmc.photo %}
                        <img src="{{ url_for('static', filename='uploads/' + tmc.photo) }}" 
                             alt="Фото ТМЦ" 
                             style="max-width: 100px; max-height: 100px; object-fit: contain; border: 1px solid #dee2e6; border-radius: 4px;">
                    {% else %}
                        <span class="text-muted">Нет фото</span>
                    {% endif %}
                </td>
                <td>{{ tmc.buhname }}</td>
                <td>{{ tmc.sernum or '-' }}</td>
                <td>{{ tmc.invnum or '-' }}</td>
                <td>{{ tmc.comment or '-' }}</td>
                <td>
                    <a href="{{ url_for('edit_tmc', tmc_id=tmc.id) }}" class="btn btn-outline-secondary btn-sm me-1">Редактировать</a>
                    <form action="{{ url_for('delete_tmc', tmc_id=tmc.id) }}" method="POST" style="display:inline;">
                        <button type="submit" class="btn btn-outline-secondary btn-sm" onclick="return confirm('Вы уверены, что хотите удалить этот ТМЦ?');">Удалить</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>В базе данных пока нет ТМЦ.</p>
{% endif %}
{% endblock %}